
> matura-mvp@1.0.0 dev
> next dev -H 0.0.0.0

  â–² Next.js 14.2.15
  - Local:        http://localhost:3001
  - Network:      http://0.0.0.0:3001
  - Environments: .env.local

 âœ“ Starting...
 âœ“ Ready in 2.9s
 â—‹ Compiling /api/chat ...
 âœ“ Compiled /api/chat in 1026ms (57 modules)
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:10:11.910Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'content-length': '131',
  'content-type': 'application/json',
  host: 'localhost:3001',
  'user-agent': 'curl/8.5.0',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:10:11.913Z
[DEBUG] Raw request body received (length: 121 ): {
    "messages": [
      {
        "role": "user",
        "content": "ã“ã‚“ã«ã¡ã¯"
      }
    ],
    "phase": "FreeTalk"
  }
[DEBUG] Request body parsed successfully
[DEBUG] Body contents: {
  "messages": [
    {
      "role": "user",
      "content": "ã“ã‚“ã«ã¡ã¯"
    }
  ],
  "phase": "FreeTalk"
}
[DEBUG] Message from UI: undefined
[DEBUG] Phase: FreeTalk
[DEBUG] Messages count: 1
 POST /api/chat 400 in 1301ms
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:10:30.966Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'content-length': '63',
  'content-type': 'application/json',
  host: 'localhost:3001',
  'user-agent': 'curl/8.5.0',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:10:30.966Z
[DEBUG] Raw request body received (length: 53 ): {
    "message": "ã“ã‚“ã«ã¡ã¯",
    "phase": "FreeTalk"
  }
[DEBUG] Request body parsed successfully
[DEBUG] Body contents: {
  "message": "ã“ã‚“ã«ã¡ã¯",
  "phase": "FreeTalk"
}
[DEBUG] Message from UI: ã“ã‚“ã«ã¡ã¯
[DEBUG] Phase: FreeTalk
[DEBUG] Messages count: 0
[/api/chat] Calling OpenAI API with phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Starting OpenAI API call
ğŸ¤– [OPENAI-DEBUG] Phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Messages count: 1
ğŸ¤– [OPENAI-DEBUG] Signal provided: true
ğŸ¤– [OPENAI-DEBUG] Model: gpt-4
ğŸ¤– [OPENAI-DEBUG] OpenAI API call completed successfully
ğŸ¤– [OPENAI-DEBUG] Response choices: 1
ğŸ¤– [OPENAI-DEBUG] First choice content length: 40
[/api/chat] OpenAI API response received, length: 40
[/api/chat] Request completed successfully in 2666 ms
[/api/chat] status: 200
 POST /api/chat 200 in 2690ms
 â—‹ Compiling / ...
 âœ“ Compiled / in 4.2s (1301 modules)
 âš  Unsupported metadata viewport is configured in metadata export in /. Please move it to viewport export instead.
Read more: https://nextjs.org/docs/app/api-reference/functions/generate-viewport
 GET / 200 in 4479ms
 âœ“ Compiled in 377ms (655 modules)
 âœ“ Compiled /api/chat in 121ms (670 modules)
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:17:27.186Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'accept-encoding': 'gzip, deflate, br, zstd',
  'accept-language': 'ja,en;q=0.9,en-GB;q=0.8,en-US;q=0.7',
  connection: 'keep-alive',
  'content-length': '105',
  'content-type': 'application/json',
  host: 'localhost:3001',
  origin: 'http://localhost:3001',
  referer: 'http://localhost:3001/',
  'sec-ch-ua': '"Not A(Brand";v="8", "Chromium";v="132", "Microsoft Edge";v="132"',
  'sec-ch-ua-mobile': '?0',
  'sec-ch-ua-platform': '"Windows"',
  'sec-fetch-dest': 'empty',
  'sec-fetch-mode': 'cors',
  'sec-fetch-site': 'same-origin',
  'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36 Edg/132.0.0.0',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:17:27.187Z
[DEBUG] Raw request body received (length: 0 ): 
[DEBUG] Empty request body received
 âœ“ Compiled in 392ms (1278 modules)
 âš  Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
 âš  Unsupported metadata viewport is configured in metadata export in /. Please move it to viewport export instead.
Read more: https://nextjs.org/docs/app/api-reference/functions/generate-viewport
 GET / 200 in 134ms
 âœ“ Compiled in 231ms (1278 modules)
 âš  Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
 âš  Unsupported metadata viewport is configured in metadata export in /. Please move it to viewport export instead.
Read more: https://nextjs.org/docs/app/api-reference/functions/generate-viewport
 GET / 200 in 120ms
 âœ“ Compiled in 244ms (1292 modules)
 âœ“ Compiled in 247ms (1292 modules)
 âœ“ Compiled /api/chat in 181ms (670 modules)
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:21:17.221Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'accept-encoding': 'gzip, deflate',
  'accept-language': '*',
  connection: 'keep-alive',
  'content-length': '56',
  'content-type': 'application/json',
  host: 'localhost:3001',
  'sec-fetch-mode': 'cors',
  'user-agent': 'node',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:21:17.222Z
[DEBUG] Raw request body received (length: 50 ): {"message":"ãƒ†ã‚¹ãƒˆ","messages":[],"phase":"FreeTalk"}
[DEBUG] Request body parsed successfully
[DEBUG] Body contents: {
  "message": "ãƒ†ã‚¹ãƒˆ",
  "messages": [],
  "phase": "FreeTalk"
}
[DEBUG] Message from UI: ãƒ†ã‚¹ãƒˆ
[DEBUG] Phase: FreeTalk
[DEBUG] Messages count: 0
[/api/chat] Calling OpenAI API with phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Starting OpenAI API call
ğŸ¤– [OPENAI-DEBUG] Phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Messages count: 1
ğŸ¤– [OPENAI-DEBUG] Signal provided: true
ğŸ¤– [OPENAI-DEBUG] Model: gpt-4
ğŸ¤– [OPENAI-DEBUG] OpenAI API call completed successfully
ğŸ¤– [OPENAI-DEBUG] Response choices: 1
ğŸ¤– [OPENAI-DEBUG] First choice content length: 94
[/api/chat] OpenAI API response received, length: 94
[/api/chat] Request completed successfully in 5093 ms
[/api/chat] status: 200
 POST /api/chat 200 in 5333ms
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:21:22.340Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'accept-encoding': 'gzip, deflate',
  'accept-language': '*',
  connection: 'keep-alive',
  'content-length': '0',
  'content-type': 'application/json',
  host: 'localhost:3001',
  'sec-fetch-mode': 'cors',
  'user-agent': 'node',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:21:22.341Z
[DEBUG] Raw request body received (length: 0 ): 
[DEBUG] Empty request body received
 POST /api/chat 400 in 13ms
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:21:22.348Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'accept-encoding': 'gzip, deflate',
  'accept-language': '*',
  connection: 'keep-alive',
  'content-length': '0',
  'content-type': 'application/json',
  host: 'localhost:3001',
  'sec-fetch-mode': 'cors',
  'user-agent': 'node',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:21:22.348Z
[DEBUG] Raw request body received (length: 0 ): 
[DEBUG] Empty request body received
 POST /api/chat 400 in 5ms
 GET / 200 in 113ms
 âœ“ Compiled in 347ms (1278 modules)
 âš  Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
 â¨¯ hooks/useChatOptimized.ts (17:3) @ useEffect
 â¨¯ ReferenceError: useEffect is not defined
    at useChatOptimized (./hooks/useChatOptimized.ts:13:5)
    at MaturaProvider (./components/providers/MaturaProvider.tsx:25:91)
digest: "3477109634"
[0m [90m 15 |[39m   [0m
[0m [90m 16 |[39m   [90m// ã€Ultra Thinkã€‘: Ensure isLoading is reset on mount to prevent stale state[39m[0m
[0m[31m[1m>[22m[39m[90m 17 |[39m   useEffect(() [33m=>[39m {[0m
[0m [90m    |[39m   [31m[1m^[22m[39m[0m
[0m [90m 18 |[39m     console[33m.[39mlog([32m'ğŸ”„ [HOOK-DEBUG] useChatOptimized mounted, resetting isLoading'[39m)[0m
[0m [90m 19 |[39m     setIsLoading([36mfalse[39m)[0m
[0m [90m 20 |[39m     [36mreturn[39m () [33m=>[39m {[0m
 GET / 500 in 122ms
 âœ“ Compiled in 133ms (1278 modules)
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 â¨¯ hooks/useChatOptimized.ts (17:3) @ useEffect
 â¨¯ ReferenceError: useEffect is not defined
    at useChatOptimized (./hooks/useChatOptimized.ts:13:5)
    at MaturaProvider (./components/providers/MaturaProvider.tsx:25:91)
digest: "3477109634"
[0m [90m 15 |[39m   [0m
[0m [90m 16 |[39m   [90m// ã€Ultra Thinkã€‘: Ensure isLoading is reset on mount to prevent stale state[39m[0m
[0m[31m[1m>[22m[39m[90m 17 |[39m   useEffect(() [33m=>[39m {[0m
[0m [90m    |[39m   [31m[1m^[22m[39m[0m
[0m [90m 18 |[39m     console[33m.[39mlog([32m'ğŸ”„ [HOOK-DEBUG] useChatOptimized mounted, resetting isLoading'[39m)[0m
[0m [90m 19 |[39m     setIsLoading([36mfalse[39m)[0m
[0m [90m 20 |[39m     [36mreturn[39m () [33m=>[39m {[0m
 GET / 500 in 119ms
 âœ“ Compiled in 133ms (1278 modules)
 âš  Fast Refresh had to perform a full reload due to a runtime error.
 GET / 200 in 74ms
 âœ“ Compiled /api/chat in 90ms (670 modules)
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:40:36.620Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'accept-encoding': 'gzip, deflate',
  'accept-language': '*',
  connection: 'keep-alive',
  'content-length': '105',
  'content-type': 'application/json',
  host: 'localhost:3001',
  'sec-fetch-mode': 'cors',
  'user-agent': 'node',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:40:36.622Z
[DEBUG] Raw request body received (length: 85 ): {"message":"ã“ã‚“ã«ã¡ã¯","messages":[{"role":"user","content":"ã“ã‚“ã«ã¡ã¯"}],"phase":"FreeTalk"}
[DEBUG] Request body parsed successfully
[DEBUG] Body contents: {
  "message": "ã“ã‚“ã«ã¡ã¯",
  "messages": [
    {
      "role": "user",
      "content": "ã“ã‚“ã«ã¡ã¯"
    }
  ],
  "phase": "FreeTalk"
}
[DEBUG] Message from UI: ã“ã‚“ã«ã¡ã¯
[DEBUG] Phase: FreeTalk
[DEBUG] Messages count: 1
[/api/chat] Calling OpenAI API with phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Starting OpenAI API call
ğŸ¤– [OPENAI-DEBUG] Phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Messages count: 2
ğŸ¤– [OPENAI-DEBUG] Signal provided: true
ğŸ¤– [OPENAI-DEBUG] Model: gpt-4
ğŸ¤– [OPENAI-DEBUG] OpenAI API call completed successfully
ğŸ¤– [OPENAI-DEBUG] Response choices: 1
ğŸ¤– [OPENAI-DEBUG] First choice content length: 39
[/api/chat] OpenAI API response received, length: 39
[/api/chat] Request completed successfully in 3399 ms
[/api/chat] status: 200
 POST /api/chat 200 in 3547ms
 GET / 200 in 101ms
 âœ“ Compiled in 424ms (1292 modules)
 âœ“ Compiled in 148ms (1278 modules)
 âš  Fast Refresh had to perform a full reload. Read more: https://nextjs.org/docs/messages/fast-refresh-reload
 GET / 200 in 112ms
 âœ“ Compiled in 605ms (1292 modules)
 âœ“ Compiled /api/chat in 180ms (670 modules)
==================================================
[DEBUG] /api/chat POST request received
[DEBUG] Timestamp: 2025-06-19T10:53:18.931Z
[DEBUG] Request URL: http://0.0.0.0:3001/api/chat
[DEBUG] Request method: POST
[DEBUG] Request headers: {
  accept: '*/*',
  'accept-encoding': 'gzip, deflate',
  'accept-language': '*',
  connection: 'keep-alive',
  'content-length': '105',
  'content-type': 'application/json',
  host: 'localhost:3001',
  'sec-fetch-mode': 'cors',
  'user-agent': 'node',
  'x-forwarded-for': '127.0.0.1',
  'x-forwarded-host': 'localhost:3001',
  'x-forwarded-port': '3001',
  'x-forwarded-proto': 'http'
}
[DEBUG] Environment check:
[DEBUG] - OPENAI_API_KEY exists: true
[DEBUG] - OPENAI_API_KEY length: 164
[DEBUG] - OPENAI_API_KEY prefix: sk-...
[DEBUG] - NODE_ENV: development
==================================================
[/api/chat] Request started at: 2025-06-19T10:53:18.932Z
[DEBUG] Raw request body received (length: 85 ): {"message":"ã“ã‚“ã«ã¡ã¯","messages":[{"role":"user","content":"ã“ã‚“ã«ã¡ã¯"}],"phase":"FreeTalk"}
[DEBUG] Request body parsed successfully
[DEBUG] Body contents: {
  "message": "ã“ã‚“ã«ã¡ã¯",
  "messages": [
    {
      "role": "user",
      "content": "ã“ã‚“ã«ã¡ã¯"
    }
  ],
  "phase": "FreeTalk"
}
[DEBUG] Message from UI: ã“ã‚“ã«ã¡ã¯
[DEBUG] Phase: FreeTalk
[DEBUG] Messages count: 1
[/api/chat] Calling OpenAI API with phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Starting OpenAI API call
ğŸ¤– [OPENAI-DEBUG] Phase: FreeTalk
ğŸ¤– [OPENAI-DEBUG] Messages count: 2
ğŸ¤– [OPENAI-DEBUG] Signal provided: true
ğŸ¤– [OPENAI-DEBUG] Model: gpt-4
ğŸ¤– [OPENAI-DEBUG] OpenAI API call completed successfully
ğŸ¤– [OPENAI-DEBUG] Response choices: 1
ğŸ¤– [OPENAI-DEBUG] First choice content length: 42
[/api/chat] OpenAI API response received, length: 42
[/api/chat] Request completed successfully in 2376 ms
[/api/chat] Final AI response content: ã“ã‚“ã«ã¡ã¯ï¼ç´ æ•µãªä¸€æ—¥ã‚’ãŠéã”ã—ã§ã—ã‚‡ã†ã‹ï¼Ÿä½•ã‹ç§ã«ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ
[/api/chat] status: 200
 POST /api/chat 200 in 2615ms
